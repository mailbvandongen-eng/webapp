<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <title>Detectorkaart V2</title>

    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
      }

      #app {
        height: 100vh;
        width: 100vw;
        display: flex;
        flex-direction: column;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }

      .app-header {
        padding: 8px 12px;
        background: #111827;
        color: #e5e7eb;
        border-bottom: 1px solid #1f2937;
      }

      .app-title {
        font-size: 16px;
        font-weight: 600;
      }

      .app-subtitle {
        font-size: 11px;
        color: #9ca3af;
      }

      #map {
        flex: 1;
        width: 100%;
      }

      .map-button {
        position: absolute;
        right: 12px;
        top: 60px;
        z-index: 1000;
        border: none;
        border-radius: 999px;
        padding: 10px 12px;
        font-size: 18px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        background: #111827;
        color: #f9fafb;
      }

      .map-button:hover {
        transform: translateY(-1px);
      }

      .gps-marker {
        stroke-width: 3px;
      }

      .leaflet-control-container .leaflet-control {
        border-radius: 6px;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <header class="app-header">
        <div class="app-title">Detectorkaart V2</div>
        <div class="app-subtitle">Prototype ‚Äì basis staat, toeters komen later</div>
      </header>

      <div id="map"></div>

      <button id="gps-btn" class="map-button">
        üìç
      </button>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const map = L.map("map", {
          zoomControl: true,
        }).setView([52.07, 4.35], 12); // Den Haag-ish

        const osm = L.tileLayer(
          "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
          {
            maxZoom: 19,
            attribution:
              '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a>',
          }
        );

        osm.addTo(map);

        let gpsMarker = null;
        let gpsAccuracyCircle = null;
        let gpsActive = false;

        function updateGps(positionEvent) {
          const latlng = positionEvent.latlng;

          if (!gpsMarker) {
            gpsMarker = L.circleMarker(latlng, {
              radius: 14,
              weight: 3,
              color: "#2563eb",
              fillColor: "#3b82f6",
              fillOpacity: 0.5,
              className: "gps-marker",
            }).addTo(map);
          } else {
            gpsMarker.setLatLng(latlng);
          }

          if (!gpsAccuracyCircle) {
            gpsAccuracyCircle = L.circle(latlng, {
              radius: positionEvent.accuracy || 20,
              color: "#93c5fd",
              weight: 1,
              fillColor: "#bfdbfe",
              fillOpacity: 0.15,
            }).addTo(map);
          } else {
            gpsAccuracyCircle.setLatLng(latlng);
            gpsAccuracyCircle.setRadius(positionEvent.accuracy || 20);
          }
        }

        function onLocationFound(e) {
          updateGps(e);

          if (!gpsActive) {
            map.setView(e.latlng, 17);
            gpsActive = true;
          }
        }

        function onLocationError(e) {
          alert("Kon je locatie niet bepalen: " + e.message);
        }

        map.on("locationfound", onLocationFound);
        map.on("locationerror", onLocationError);

        function startGpsTracking() {
          map.locate({
            setView: !gpsActive,
            maxZoom: 18,
            watch: true,
            enableHighAccuracy: true,
          });
        }

        const gpsBtn = document.getElementById("gps-btn");
        if (gpsBtn) {
          gpsBtn.addEventListener("click", () => {
            startGpsTracking();
          });
        }
      });
    </script>
  </body>
</html>
